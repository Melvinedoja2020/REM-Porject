{% extends 'dashboard_base.html' %}
{% load static %}
{% block content %}

<div class="main-content">
  <div class="main-content-inner">
    <div class="main-content-wrap">

      <!-- ======== CUSTOMER DASHBOARD STATS ======== -->
      <div class="tf-section-4 mb-30 grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">

        <!-- Favorites -->
        <div class="wg-chart-default">
          <div class="flex items-center justify-between">
            <div class="flex items-center gap-3">
              <div class="image">
                <i class="icon-heart text-red-500"></i>
              </div>
              <div>
                <div class="body-text mb-1">Favorite Properties</div>
                <h4>{{ favorite_count|default:0 }}</h4>
              </div>
            </div>
            <div class="box-icon-trending up">
              <i class="icon-trending-up"></i>
              <div class="body-title number">+{{ favorite_count|default:0 }}</div>
            </div>
          </div>
          <div class="wrap-chart"><div id="chart-favorites"></div></div>
        </div>

        <!-- Viewings -->
        <div class="wg-chart-default">
          <div class="flex items-center justify-between">
            <div class="flex items-center gap-3">
              <div class="image">
                <i class="icon-eye"></i>
              </div>
              <div>
                <div class="body-text mb-1">Total Viewings</div>
                <h4>{{ total_viewings|default:0 }}</h4>
                <div class="text-xs text-muted">Upcoming: {{ upcoming_viewings|default:0 }}</div>
              </div>
            </div>
            <div class="box-icon-trending up">
              <i class="icon-calendar"></i>
              <div class="body-title number">{{ upcoming_viewings|default:0 }}</div>
            </div>
          </div>
          <div class="wrap-chart"><div id="chart-viewings"></div></div>
        </div>

        <!-- Leads -->
        <div class="wg-chart-default">
          <div class="flex items-center justify-between">
            <div class="flex items-center gap-3">
              <div class="image">
                <i class="icon-user"></i>
              </div>
              <div>
                <div class="body-text mb-1">Interested Properties (Leads)</div>
                <h4>{{ total_leads|default:0 }}</h4>
                <div class="text-xs text-muted">Active: {{ active_leads|default:0 }}</div>
              </div>
            </div>
            <div class="box-icon-trending up">
              <i class="icon-trending-up"></i>
              <div class="body-title number">{{ active_leads|default:0 }}</div>
            </div>
          </div>
          <div class="wrap-chart"><div id="chart-leads"></div></div>
        </div>

        <!-- Engagement Score (optional aesthetic block) -->
        <div class="wg-chart-default">
          <div class="flex items-center justify-between">
            <div class="flex items-center gap-3">
              <div class="image">
                <i class="icon-activity"></i>
              </div>
              <div>
                <div class="body-text mb-1">Engagement Score</div>
                <h4>{{ total_leads|add:favorite_count|add:upcoming_viewings|default:0 }}</h4>
                <div class="text-xs text-muted">Calculated overview</div>
              </div>
            </div>
            <div class="box-icon-trending up">
              <i class="icon-trending-up"></i>
              <div class="body-title number">Active</div>
            </div>
          </div>
          <div class="wrap-chart"><div id="chart-engagement"></div></div>
        </div>
      </div>

      <!-- ======== PROPERTY OVERVIEW TABLE ======== -->
      <div class="tf-section">
        <div class="wg-box">
          <div class="flex items-center justify-between mb-3">
            <h5>Recent Viewings & Leads</h5>
          </div>

          <div class="wg-table table-product-overview">
            <ul class="table-title flex gap20 mb-14">
              <li><div class="body-title">Category</div></li>
              <li><div class="body-title">Property</div></li>
              <li><div class="body-title">Status</div></li>
              <li><div class="body-title">Date</div></li>
              <li><div class="body-title">Action</div></li>
            </ul>

            <div class="divider mb-14"></div>

            {% if total_viewings or total_leads %}
              {% for viewing in user.propertyviewing_set.all|slice:":5" %}
                <ul class="flex items-center justify-between gap20 mb-10">
                  <li><div class="body-text">Viewing</div></li>
                  <li><div class="body-text">{{ viewing.property.title }}</div></li>
                  <li><div class="badge
                      {% if viewing.status == 'CONFIRMED' %}bg-success{% elif viewing.status == 'PENDING' %}bg-warning{% else %}bg-secondary{% endif %}">
                      {{ viewing.status }}
                    </div></li>
                  <li><div class="body-text">{{ viewing.scheduled_time|date:"M d, Y" }}</div></li>
                  <li><a href="" class="btn btn-outline-primary btn-sm">View</a></li>
                </ul>
              {% endfor %}

              {% for lead in user.leads.all|slice:":5" %}
                <ul class="flex items-center justify-between gap20 mb-10">
                  <li><div class="body-text">Lead</div></li>
                  <li><div class="body-text">{{ lead.property.title }}</div></li>
                  <li><div class="badge bg-info">{{ lead.status }}</div></li>
                  <li><div class="body-text">{{ lead.created_at|date:"M d, Y" }}</div></li>
                  <li><a href="" class="btn btn-outline-primary btn-sm">View</a></li>
                </ul>
              {% endfor %}
            {% else %}
              <div class="text-center py-4">
                <p class="body-text text-muted">No activity yet. Start exploring properties!</p>
              </div>
            {% endif %}
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- bottom-page -->
  <div class="bottom-page">
    <div class="body-text">Copyright Â© 2025 REM. Designed with</div>
    <i class="icon-heart text-red-500"></i>
    <div class="body-text">by <a href="#">REM</a>. All rights reserved.</div>
  </div>
</div>

{% endblock content %}
