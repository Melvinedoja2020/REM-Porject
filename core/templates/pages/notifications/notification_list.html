{% extends 'dashboard_base.html' %}
{% load static %}
{% block content %}

<!-- main-content -->
<div class="main-content">
  <div class="main-content-inner">
    <div class="main-content-wrap">

      <!-- Header Section -->
      <div class="flex items-center flex-wrap justify-between gap20 mb-27">
        <div>
          <h3 class="modern-title">Notifications</h3>
          <p class="modern-subtitle">View and manage your recent notifications</p>
        </div>

        <div class="table-controls">
          <div class="search-box">
            <i class="icon-search"></i>
            <input type="text" placeholder="Search notifications...">
          </div>
          {% comment %} <form method="post" action="{% url 'notification:mark_all_read' %}">
            {% csrf_token %}
            <button type="submit" class="btn-primary">
              <i class="icon-check-circle"></i>
              Mark All as Read
            </button>
          </form> {% endcomment %}
        </div>
      </div>

      <!-- Modern Table -->
      <div class="modern-table-container">
        <div class="wg-box modern-table-wrapper">
          <div class="wg-table table-product-list modern-table">

            <!-- Table Header -->
            <div class="table-header modern-header flex gap20">
              <div class="header-col property-col">
                <div class="body-title">Notification</div>
              </div>
              <div class="header-col">
                <div class="body-title">Message</div>
              </div>
              <div class="header-col">
                <div class="body-title">Status</div>
              </div>
              <div class="header-col">
                <div class="body-title">Date</div>
              </div>
              <div class="header-col actions-col">
                <div class="body-title">Actions</div>
              </div>
            </div>

            <!-- Notification Rows -->
            <div class="table-body modern-body">
              {% for notification in notifications %}
              <div class="table-row modern-row flex items-center {% if not notification.is_read %}unread-row{% endif %}">
                <div class="table-col property-col">
                  <div class="property-info-cell">
                    <div class="property-image">
                      <img src="{% static 'images/notification.jpg' %}" alt="Notification">
                      {% if not notification.is_read %}
                      <div class="featured-badge">
                        <i class="icon-bell"></i>
                      </div>
                      {% endif %}
                    </div>
                    <div class="property-details">
                      <a href="{% url 'notification:notification_detail' notification.pk %}" class="property-title">
                        {{ notification.title|truncatechars:40 }}
                      </a>
                      {% if notification.property %}
                        <div class="property-location">
                          <i class="icon-map-pin"></i>
                          Related to: {{ notification.property.title|default:"N/A" }}
                        </div>
                      {% endif %}
                    </div>
                  </div>
                </div>

                <div class="table-col">
                  <div class="price-cell">
                    <span class="price-value">{{ notification.message|truncatechars:70 }}</span>
                  </div>
                </div>

                <div class="table-col">
                  <div class="status-cell">
                    {% if notification.is_read %}
                      <span class="status-badge available">
                        <i class="icon-check-circle"></i> Read
                      </span>
                    {% else %}
                      <span class="status-badge unavailable">
                        <i class="icon-bell"></i> Unread
                      </span>
                    {% endif %}
                  </div>
                </div>

                <div class="table-col">
                  <div class="type-cell">
                    <span class="type-badge">{{ notification.created_at|date:"M d, Y h:i A" }}</span>
                  </div>
                </div>

                <div class="table-col actions-col">
                  <div class="actions-cell">
                    <!-- View -->
                    <a href="{% url 'notification:notification_detail' notification.pk %}" class="action-btn view" title="View Notification">
                      <i class="icon-eye"></i>
                    </a>

                    <!-- Mark as Read -->
                    {% if not notification.is_read %}
                    <form action="{% url 'notification:notification_mark_read' notification.pk %}" method="post" class="action-form">
                      {% csrf_token %}
                      <button type="submit" class="action-btn edit" title="Mark as Read">
                        <i class="icon-check"></i>
                      </button>
                    </form>
                    {% endif %}

                    <!-- Delete -->
                    <form action="{% url 'notification:notification_delete' notification.pk %}" method="post" class="action-form">
                      {% csrf_token %}
                      <button type="submit" class="action-btn delete" title="Delete Notification">
                        <i class="icon-trash-2"></i>
                      </button>
                    </form>
                  </div>
                </div>
              </div>
              {% empty %}
              <div class="empty-table-state">
                <div class="empty-icon">
                  <i class="icon-bell"></i>
                </div>
                <h4>No Notifications Found</h4>
                <p>You don’t have any notifications yet.</p>
              </div>
              {% endfor %}
            </div>
          </div>

          <div class="table-divider"></div>

          <!-- Pagination -->
          {% if is_paginated %}
          <div class="table-footer flex items-center justify-between flex-wrap gap10">
            <div class="pagination-info">
              Showing <strong>{{ page_obj.start_index }}</strong> - <strong>{{ page_obj.end_index }}</strong> of <strong>{{ page_obj.paginator.count }}</strong> notifications
            </div>
            <ul class="wg-pagination modern-pagination">
              {% if page_obj.has_previous %}
                <li><a href="?page={{ page_obj.previous_page_number }}" class="pagination-nav"><i class="icon-chevron-left"></i></a></li>
              {% endif %}
              {% for num in page_obj.paginator.page_range %}
                {% if page_obj.number == num %}
                  <li><a href="?page={{ num }}" class="pagination-page active">{{ num }}</a></li>
                {% else %}
                  <li><a href="?page={{ num }}" class="pagination-page">{{ num }}</a></li>
                {% endif %}
              {% endfor %}
              {% if page_obj.has_next %}
                <li><a href="?page={{ page_obj.next_page_number }}" class="pagination-nav"><i class="icon-chevron-right"></i></a></li>
              {% endif %}
            </ul>
          </div>
          {% endif %}
        </div>
      </div>
    </div>
  </div>

  <!-- bottom-page -->
  <div class="bottom-page">
    <div class="body-text">Copyright © 2025 REM. Design with</div>
    <i class="icon-heart"></i>
    <div class="body-text">
      by <a href="#">REM</a> All rights reserved.
    </div>
  </div>
</div>
<!-- /main-content -->

{% endblock content %}
